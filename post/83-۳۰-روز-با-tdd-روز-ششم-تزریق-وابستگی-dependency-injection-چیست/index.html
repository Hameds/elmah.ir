<!DOCTYPE html>
<html lang="fa-ir">
<head>

  <meta charset="utf-8" />

  
  <title>۳۰ روز با TDD: روز ششم - تزریق وابستگی (Dependency Injection) چیست؟</title>

  
  




  
  <meta name="author" content="حامد سعیدی فرد" />
  <meta name="description" content="نوشته به زبان انگلیسی روز ششم را در این آدرس می‌توانید مشاهده کنید. در روز پنجم درباره اصل Dependency Inversion گفتم و اینکه با Dependency Injection یا تزریق وابستگی متفاوت است. امروز می‌خواهیم بیشتر درباره تزریق وابستگی صحبت کنیم.
Tinker Toy و Lego همان‌طور که قبلاً هم در این سری نوشته‌ها گفتم، اتصال (Coupling) و انقیاد (binding) در نرم‌افزار یک حقیقت است. به عنوان برنامه‌نویس سعی می‌کنیم که اتصالات برنامه‌مان تا حد ممکن ضعیف باشد (به اصطلاح loosely coupled باشد) اما در نهایت برای اینکه اجزای مختلف برنامه‌ای که می‌سازیم قابل استفاده باشد باید آن‌ها را bind کنیم." />

  
  
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@hamed" />
    <meta name="twitter:title" content="۳۰ روز با TDD: روز ششم - تزریق وابستگی (Dependency Injection) چیست؟" />
    <meta name="twitter:description" content="نوشته به زبان انگلیسی روز ششم را در این آدرس می‌توانید مشاهده کنید. در روز پنجم درباره اصل Dependency Inversion گفتم و اینکه با Dependency Injection یا تزریق وابستگی متفاوت است. امروز می‌خواهیم بیشتر درباره تزریق وابستگی صحبت کنیم.
Tinker Toy و Lego همان‌طور که قبلاً هم در این سری نوشته‌ها گفتم، اتصال (Coupling) و انقیاد (binding) در نرم‌افزار یک حقیقت است. به عنوان برنامه‌نویس سعی می‌کنیم که اتصالات برنامه‌مان تا حد ممکن ضعیف باشد (به اصطلاح loosely coupled باشد) اما در نهایت برای اینکه اجزای مختلف برنامه‌ای که می‌سازیم قابل استفاده باشد باید آن‌ها را bind کنیم." />
    <meta name="twitter:image" content="https://elmah.ir/oldimg/tdd_cycle.jpg" />
  




<meta name="generator" content="Hugo 0.59.1" />


<link rel="canonical" href="https://elmah.ir/post/83-%DB%B3%DB%B0-%D8%B1%D9%88%D8%B2-%D8%A8%D8%A7-tdd-%D8%B1%D9%88%D8%B2-%D8%B4%D8%B4%D9%85-%D8%AA%D8%B2%D8%B1%DB%8C%D9%82-%D9%88%D8%A7%D8%A8%D8%B3%D8%AA%DA%AF%DB%8C-dependency-injection-%DA%86%DB%8C%D8%B3%D8%AA/" />
<link rel="alternative" href="https://elmah.ir/index.xml" title="elmah" type="application/atom+xml" />


<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="format-detection" content="telephone=no,email=no,adress=no" />
<meta http-equiv="Cache-Control" content="no-transform" />


<meta name="robots" content="index,follow" />
<meta name="referrer" content="origin-when-cross-origin" />







<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="elmah" />
<meta name="msapplication-tooltip" content="elmah" />
<meta name='msapplication-navbutton-color' content="#5fbf5e" />
<meta name="msapplication-TileColor" content="#5fbf5e" />
<meta name="msapplication-TileImage" content="/img/tile-image-windows.png" />
<link rel="icon" href="https://elmah.ir/img/favicon.ico" />
<link rel="icon" type="image/png" sizes="16x16" href="https://elmah.ir/img/favicon-16x16.png" />
<link rel="icon" type="image/png" sizes="32x32" href="https://elmah.ir/img/favicon-32x32.png" />
<link rel="icon" sizes="192x192" href="https://elmah.ir/img/touch-icon-android.png" />
<link rel="apple-touch-icon" href="https://elmah.ir/img/touch-icon-apple.png" />
<link rel="mask-icon" href="https://elmah.ir/img/safari-pinned-tab.svg" color="#5fbf5e" />



<link rel="stylesheet" href="//cdn.bootcss.com/video.js/6.2.8/alt/video-js-cdn.min.css" />

<link rel="stylesheet" href="https://elmah.ir/css/bundle.css" />
<link rel="stylesheet" href="https://elmah.ir/css/elmah.css" />

  
  <!--[if lt IE 9]>
    <script src="//cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <script src="//cdn.bootcss.com/video.js/6.2.8/ie8/videojs-ie8.min.js"></script>
  <![endif]-->

<!--[if lte IE 11]>
    <script src="//cdn.bootcss.com/classlist/1.1.20170427/classList.min.js"></script>
  <![endif]-->


<script src="//cdn.bootcss.com/object-fit-images/3.2.3/ofi.min.js"></script>


<script src="//cdn.bootcss.com/smooth-scroll/12.1.4/js/smooth-scroll.polyfills.min.js"></script>


</head>
  <body>
    
    <div class="suspension">
      <a title="Go to top" class="to-top is-hide"><span class="icon icon-up"></span></a>
      
        
      
    </div>
    
    
<header class="site-header">
  <img class="avatar" src="https://avatars1.githubusercontent.com/u/1385656?s=460&amp;v=4" alt="Avatar">
  
  <h2 class="title">elmah</h2>
  
  <p class="subtitle">~ یادداشت‌های یک برنامه‌نویس خوشحال ~</p>
  <button class="menu-toggle" type="button">
    <span class="icon icon-menu"></span>
  </button>
  <nav class="site-menu collapsed">
    <h2 class="offscreen">Main Menu</h2>
    <ul class="menu-list">
      
      
      
      
        <li class="menu-item  is-active"><a href="https://elmah.ir/">صفحه نخست</a></li>
      
        <li class="menu-item "><a href="https://elmah.ir/series/">نوشته‌های دنباله‌دار</a></li>
      
        <li class="menu-item "><a href="https://hameds.github.io/slides/">پرزنت‌های من</a></li>
      
        <li class="menu-item "><a href="https://elmah.ir/about/">درباره من</a></li>
      
    </ul>
  </nav>
  <nav class="social-menu collapsed">
    <h2 class="offscreen">Social Networks</h2>
    <ul class="social-list">

      

      
      <li class="social-item">
        <a href="//github.com/hameds" title="GitHub"><span class="icon icon-github"></span></a>
      </li>

      <li class="social-item">
        <a href="//twitter.com/hamed" title="Twitter"><span class="icon icon-twitter"></span></a>
      </li>

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <li class="social-item">
        <a href="https://elmah.ir/index.xml"><span class="icon icon-rss" title="RSS"></span></a>
      </li>

    </ul>
  </nav>
</header>

<section class="main post-detail">
  <header class="post-header">
    <h1 class="post-title">۳۰ روز با TDD: روز ششم - تزریق وابستگی (Dependency Injection) چیست؟</h1>
    <p class="post-meta">
      @حامد سعیدی فرد ·
      5 دقیقه خواندن</p>
  </header>
  <article class="post-content">

<p>نوشته به زبان انگلیسی روز ششم را در <a href="http://blogs.telerik.com/justteam/posts/13-09-20/30-days-of-tdd-day-six-what-is-dependency-injection-">این آدرس</a> می‌توانید مشاهده کنید. در <a href="https://elmah.ir/post/82-30-روز-با-tdd--روز-پنجم---کد-solid-ایجاد-کنید/">روز پنجم</a> درباره اصل Dependency Inversion گفتم و اینکه با Dependency Injection یا تزریق وابستگی متفاوت است. امروز می‌خواهیم بیشتر درباره تزریق وابستگی صحبت کنیم.</p>

<h3 id="tinker-toy-و-lego">Tinker Toy و Lego</h3>

<p>همان‌طور که قبلاً هم در این سری نوشته‌ها گفتم، اتصال (Coupling) و انقیاد (binding) در نرم‌افزار یک حقیقت است. به عنوان برنامه‌نویس سعی می‌کنیم که اتصالات برنامه‌مان تا حد ممکن ضعیف باشد (به اصطلاح loosely coupled باشد) اما در نهایت برای اینکه اجزای مختلف برنامه‌ای که می‌سازیم قابل استفاده باشد باید آن‌ها را bind کنیم. مثال مشابه پیوندهای ضعیف نرم‌افزار، که در زندگی روزمره از آن استفاده کرده‌ایم بازی‌های لگو و تینکر توی (یک بازی مخصوص بچه‌ها که مشابه لگو با ترکیب اجزای مختلف می‌توان وسایل جدید ساخت) هستند.<br />
ایده مشابه در نرم‌افزار هم مشابه لگو این است که اگر برنامه‌تان را از اجزا (component) مختلف که بر اساس یک اینترفیس استاندارد ساخته شده‌اند بسازید، باید بتوانید نرم‌افزارهای مختلف را با استفاده از ترکیب‌های مختلف این اجزا ایجاد کنید.</p>

<p>به نظر ایده جالبی است، اما چطور این کار را با استفاده از کد نرم‌افزاری انجام دهیم؟ برای پاسخ به این سوال به اصول SOLID‌ که در نوشته قبلی به آن‌ها اشاره کردیم نیاز داریم. گرچه هر ۵ اصل به تولید نرم‌افزاری که loosely coupled باشد کمک می‌کنند اما دو تا از آن‌ها برای به صورت خاص برای این منظور لازم هستند.</p>

<p>اصل Liskov Substitution یا LSP‌ می‌گفت که ما می‌توانیم یک کلاس مشتق شده را جایگزین کلاس پایه (base) کنیم بدون اینکه برنامه دچار مشکل شود. ما می‌توانیم این اصل را به Interface ها به این صورت تعمیم دهیم که کلاس‌هایی که یک اینترفیس مشترک را پیاده‌سازی می‌کنند را می‌توان جایگزین هم کرد. بر این اساس، پرنده و هواپیما و سوپرمن گرچه خیلی با هم متفاوتند اما هر سه می‌توانند پرواز کنند. بنابراین تا زمانی که آن‌ها اینترفیس IFly را پیاده‌سازی کنند و برای من فقط پرواز مهم باشد، می‌توانم از هر کدام از آن کلاس‌ها (پرنده و هواپیما و سوپرمن) استفاده کنم.</p>

<p>اصل Dependency Inversion یا DIP به ما می‌گوید که کد ما باید به abstraction ها وابسته باشد نه یک پیاده‌سازی واقعی. برنامه من ممکن است به یک انبار داده جهت ذخیره‌سازی اطلاعات نیاز داشته باشد، اگر من خودم را به یک دیتابیس رابطه‌ای مثل SQL Server محدود کنم،‌ راه خودم بر دیگر پیاده‌سازی‌ها برای انبار داده مثل file system و web service و object database یا هر چیز دیگری که برای ذخیره‌سازی اطلاعات می‌توان از آن استفاده کرد بسته‌ام. این روش اشتباه طراحی باعث ایجاد محدودیت در نرم‌افزار من از طریق اتکا به یک نوع خاص از انبار داده به جای استفاده از ایده «چیزی که داده ذخیره می‌کند» می‌شود.</p>

<h3 id="اتصال-decouple-اجزا-components-از-طریق-تزریق-وابستگی">اتصال (decouple) اجزا (components) از طریق تزریق وابستگی</h3>

<p>با استفاده از LSP و DIP ما می‌توانیم به یک روش برای تولید نرم‌افزار با وابستگی‌ها ضعیف (loosely coupled dependencies) برسیم. این روش Dependency Injection یا تزریق وابستگی نام دارد و بر خلاف نامی که دارد بسیار ساده است. کد نمونه زیر را در نظر بگیرید</p>

<script type="application/javascript" src="https://gist.github.com/hameds/93260960619506bcd7b6eeab9cfb4b5f.js"></script>


<p>تعریف SqlDataStoreProvider و DbLoggingProvider و ProdWebServiceProvider خالی است ولی اگر بخواهید می‌توانید کد کامل را در <a href="https://gist.github.com/JamesBender/6588245">این gist‌</a> ببینید.</p>

<p>کد بالا احتمالاً آشنا به نظر می رسد. بدون شک هر برنامه تجاری در NET. نیازمند انبار داده جهت ذخیره‌سازی اطلاعات است. خیلی از شرکت‌ها می‌خواهند که اتفاقاتی که در برنامه می‌افتد را ثبت کنند و این یعنی نیاز به کدی برای log کردن. با متداول شدن استفاده از سیستم‌های توزیع شده استفاده از وب سرویس هم به یک نیاز طبیعی تبدیل شده است.</p>

<p>برنامه‌های زیادی در NET. به خصوص قدیمی‌ترها از کد مشابه بالا برای ایجاد instance از کلاس‌هایی که به آن‌ها وابسته هستند استفاده می‌کنند. مشکل این روش این است که کلاس BusinessService  به شکل محکم (tight) یا استاتیک به پیاده‌سازی‌های خاصی bind شده‌ است. این کار، نرم‌افزار را شکننده می‌کند و تغییرات به ظاهر ساده در کلاس‌ها در آینده ممکن است عواقب غیرقابل پیش‌بینی داشته باشد. این همچنین امکان تصمیم‌گیری درباره object ای که می‌خواهیم به آن bind کنیم را از بین می‌برد. این یعنی من محدود به هر کدی که در زمان کامپایل استفاده شده است هستم.</p>

<p>کاری که تزریق وابستگی یا DI انجام می‌دهد این است که static binding به وابستگی‌ها را حذف می‌کند. برای این کار کلاس مصرف‌کننده (consumer) پیاده‌سازی‌های مختلفی که object می‌خواهد از آن‌ها استفاده کند را ارائه می‌کند. به کد زیر نگاه کنید:</p>

<script type="application/javascript" src="https://gist.github.com/hameds/bcbcbed3b9dc272eaabf39514e85cb0f.js"></script>


<p>با تزریق وابستگی‌های کلاس از طریق سازنده (constructor) می‌توانم پیاده‌سازی اصلی که واقعاً می‌خواهم در زمان اجرا (runtime) از آن استفاده کنم را کنترل کنم. پیاده‌سازی اصلی فقط باید بر اساس abstraction ای که کلاس مصرف کننده (کلاس BusinessService) نیاز دارد باشد. <br />
به عنوان مثال من می‌توانم هر کلاسی که از DataStoreProvider مشتق شده باشد (مثلاً SqlDataStoreProvider) را به کلاس BusinessService  از طریق سازنده (constructor) پاس بدهم و کلاس BusinessService می‌تواند از آن استفاده کند. این روش همچنین کد را انعطاف‌پذیرتر در برابر تغییرات می‌کند. از آنجایی که کلاس فقط به یک abstraction از dependency وابسته است من می‌توانم در کلاس مشتق شده (که به کلاس BusinessService پاس داده می‌شود) تغییر ایجاد کنم و کلاس مصرف کننده یعنی BusinessService همچنان کار کند.</p>

<p>قرار دادن وابستگی‌ها در یک ساختار کلاس ارث‌بری شده یک روش درست و معتبر برای تزریق وابستگی (DI) است. با این حال استفاده از Interface به دلیل اینکه به رابطه سلسله‌مراتبی وابسته نیست (در واقع مثل کلاس‌های ارث‌بری شده، به صورت سلسله‌مراتبی نیستند) می‌تواند یک راه انعطاف‌پذیرتر برای تعریف abstraction مشترک فراهم کند.</p>

<p>اگر کد مربوط به کلاس BusinessService را برای اینکه به Interface متکی باشد refactor کنم، انعطاف‌پذیری بیشتر در binding بدست می‌آورم و خروجی شبیه کد زیر خواهد بود</p>

<script type="application/javascript" src="https://gist.github.com/hameds/eb1d97dc2ff29d367a4af0e0886c5692.js"></script>


<p>همان‌طور که می‌بینید تزریق وابستگی یک تکنیک ساده اما قدرتمند است. این تکنیک به شما این امکان را می‌دهد که با ایجاد تنوع در binding وابستگی‌ها در زمان اجرا، برنامه‌های loosely couple ایجاد کنید. در نوشته بعدی درباره software factories و فریمورک‌های DI صحبت خواهیم کرد.</p>

<p>ادامه دارد&hellip;</p>
</article>
  <footer class="post-footer">
    
    <p class="post-copyright">
      این
      نوشته <strong>2150</strong> روز پیش منتشر شده و محتوای آن ممکن است برای
      امروز، غیردقیق یا حتی اشتباه باشد. اگر اشتباهی دیدید لطفاً در گیت‌هاب اعلام یا رفعش کنید.
    </p>
  </footer>
  <hr>
  <div id="graphcomment"></div>
  <script type="text/javascript">

     

    
    window.gc_params = {
      graphcomment_id: 'elmah',

      
      fixed_header_height: 0,
    };

     


    (function () {
      var gc = document.createElement('script'); gc.type = 'text/javascript'; gc.async = true;
      gc.src = 'https://graphcomment.com/js/integration.js?' + Math.round(Math.random() * 1e8);
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(gc);
    })();

  </script>

  
  
  
</section>
<footer class="site-footer">
  <p>© 2017-2019 elmah</p>
  <p>Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> with theme <a href="https://github.com/laozhu/hugo-nuo" target="_blank">Nuo</a>.</p>
  
</footer>



<script async src="//cdn.bootcss.com/video.js/6.2.8/alt/video.novtt.min.js"></script>
<script async src="//cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [['$$','$$'], ['\[','\]']],
      processEscapes: true,
      processEnvironments: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      TeX: { equationNumbers: { autoNumber: "AMS" },
      extensions: ["AMSmath.js", "AMSsymbols.js"] }
    }
  });
</script>
<script type="text/x-mathjax-config">
  // Fix <code> tags after MathJax finishes running. This is a
  // hack to overcome a shortcoming of Markdown. Discussion at
  // https://github.com/mojombo/jekyll/issues/199
  MathJax.Hub.Queue(() => {
    MathJax.Hub.getAllJax().map(v => v.SourceElement().parentNode.className += ' has-jax');
  });
</script>

<script src="https://elmah.ir/js/bundle.js"></script>




  </body>
</html>
